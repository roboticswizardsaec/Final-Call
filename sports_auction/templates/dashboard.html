<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pro Auction Live</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Teko:wght@300;400;500;600;700&family=Rajdhani:wght@500;600;700&family=Inter:wght@400;500;600;800&display=swap" rel="stylesheet">

    <style>
        /* --- CORE TYPOGRAPHY --- */
        .font-hero { font-family: 'Teko', sans-serif; }
        .font-tech { font-family: 'Rajdhani', sans-serif; }
        .font-ui { font-family: 'Inter', sans-serif; }
        
        /* --- SCROLLBARS --- */
        * { scrollbar-width: thin; scrollbar-color: #06b6d4 rgba(0,0,0,0.1); }
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: rgba(0,0,0,0.1); }
        ::-webkit-scrollbar-thumb { background: rgba(6,182,212,0.4); border-radius: 4px; }
        ::-webkit-scrollbar-thumb:hover { background: rgba(6,182,212,0.8); }

        /* --- ANIMATIONS --- */
        @keyframes scroll-text { 0% { transform: translateX(100%); } 100% { transform: translateX(-100%); } }
        .animate-scroll { animation: scroll-text 30s linear infinite; }
        
        @keyframes spotlight-pulse {
            0%, 100% { opacity: 0.5; transform: scale(1); }
            50% { opacity: 0.8; transform: scale(1.1); }
        }
        .spotlight { animation: spotlight-pulse 4s ease-in-out infinite; }

        @keyframes slam-in {
            0% { transform: scale(5); opacity: 0; filter: blur(20px); }
            50% { transform: scale(0.9); opacity: 1; filter: blur(0px); }
            75% { transform: scale(1.05); }
            100% { transform: scale(1); }
        }
        .animate-slam { animation: slam-in 0.6s cubic-bezier(0.2, 0.8, 0.2, 1) forwards; }

        @keyframes flash-light { 0% { background-color: white; opacity: 1; } 100% { background-color: transparent; opacity: 0; } }
        .flash-overlay { animation: flash-light 0.8s ease-out forwards; pointer-events: none; }

        @keyframes ray-rotate { from { transform: rotate(0deg); } to { transform: rotate(360deg); } }
        .rays { animation: ray-rotate 20s linear infinite; }

        /* --- GLASS --- */
        .glass-panel {
            background: rgba(255, 255, 255, 0.03);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.05);
            box-shadow: 0 4px 30px rgba(0, 0, 0, 0.1);
        }
        .glass-panel-light {
            background: rgba(255, 255, 255, 0.75);
            backdrop-filter: blur(16px);
            border: 1px solid rgba(255, 255, 255, 0.6);
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.05);
        }
    </style>
</head>
<body class="font-ui overflow-auto selection:bg-cyan-500/30">
    <div id="root"></div>

    {% verbatim %}
    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- ICONS ---
        const Icon = ({ children, className }) => (
            <svg xmlns="http://www.w3.org/2000/svg" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2" strokeLinecap="round" strokeLinejoin="round" className={className}>{children}</svg>
        );
        const Trophy = ({c}) => <Icon className={c}><path d="M6 9H4.5a2.5 2.5 0 0 1 0-5H6M18 9h1.5a2.5 2.5 0 0 0 0-5H18M4 22h16M10 14.66V17c0 .55-.47.98-.97 1.21C7.85 18.75 7 20.24 7 22M14 14.66V17c0 .55.47.98.97 1.21C16.15 18.75 17 20.24 17 22M18 2H6v7a6 6 0 0 0 12 0V2Z" /></Icon>;
        const Users = ({c}) => <Icon className={c}><path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2M9 7a4 4 0 1 0 0-8 4 4 0 0 0 0 8zM22 21v-2a4 4 0 0 0-3-3.87M16 3.13a4 4 0 0 1 0 7.75" /></Icon>;
        const Gavel = ({c}) => <Icon className={c}><path d="m14 13-7.5 7.5c-.5.5-1.5.5-2 0L2 18c-.5-.5-.5-1.5 0-2L9.5 8.5M17.5 12.5l-5.5-5.5M10 2l11 11" /></Icon>;
        const XCircle = ({c}) => <Icon className={c}><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></Icon>;
        const ChevronRight = ({c}) => <Icon className={c}><path d="m9 18 6-6-6-6" /></Icon>;
        const Close = ({c}) => <Icon className={c}><path d="M18 6 6 18M6 6l12 12" /></Icon>;
        const Share2 = ({c}) => <Icon className={c}><circle cx="18" cy="5" r="3"/><circle cx="6" cy="12" r="3"/><circle cx="18" cy="19" r="3"/><line x1="8.59" y1="13.51" x2="15.42" y2="17.49"/><line x1="15.41" y1="6.51" x2="8.59" y2="10.49"/></Icon>;
        const Download = ({c}) => <Icon className={c}><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></Icon>;
        const Sun = ({c}) => <Icon className={c}><circle cx="12" cy="12" r="4"/><path d="M12 2v2"/><path d="M12 20v2"/><path d="m4.93 4.93 1.41 1.41"/><path d="m17.66 17.66 1.41 1.41"/><path d="M2 12h2"/><path d="M20 12h2"/><path d="m6.34 17.66-1.41 1.41"/><path d="m19.07 4.93-1.41 1.41"/></Icon>;
        const Moon = ({c}) => <Icon className={c}><path d="M12 3a6 6 0 0 0 9 9 9 9 0 1 1-9-9Z"/></Icon>;
        const Lock = ({c}) => <Icon className={c}><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></Icon>;
        // --- THEME ---
        const THEMES = {
            dark: {
                bg: "bg-[#020617] bg-[radial-gradient(ellipse_at_top,_var(--tw-gradient-stops))] from-slate-900 via-[#050a14] to-black", 
                text: "text-slate-100", 
                panel: "glass-panel",
                accent: "text-cyan-400", 
                subtext: "text-slate-400",
                input: "bg-black/30 border-white/10 text-white focus:border-cyan-500",
                btnMain: "bg-gradient-to-r from-cyan-500 to-blue-600 hover:from-cyan-400 hover:to-blue-500 text-white shadow-[0_0_20px_rgba(6,182,212,0.3)]",
                btnSec: "bg-white/5 hover:bg-white/10 border border-white/10 text-white",
                border: "border-white/10"
            },
            light: {
                bg: "bg-slate-50", 
                text: "text-slate-800", 
                panel: "glass-panel-light",
                accent: "text-blue-600", 
                subtext: "text-slate-500",
                input: "bg-white border-slate-300 text-black focus:border-blue-500",
                btnMain: "bg-gradient-to-r from-blue-600 to-indigo-600 hover:from-blue-500 hover:to-indigo-500 text-white shadow-lg",
                btnSec: "bg-white hover:bg-slate-50 border border-slate-300 text-slate-700",
                border: "border-slate-200"
            }
        };

        const TEAM_GRADIENTS = [
            "from-blue-600 to-indigo-700", "from-red-600 to-orange-700",
            "from-emerald-600 to-teal-700", "from-purple-600 to-pink-700",
            "from-amber-500 to-yellow-600", "from-cyan-600 to-blue-600",
            "from-lime-600 to-green-700", "from-rose-600 to-pink-700",
        ];

        function App() {
            const [data, setData] = useState(null);
            const [theme, setTheme] = useState('dark');
            const [isAdmin, setIsAdmin] = useState(false);
            const [isViewerMode, setIsViewerMode] = useState(false);
            const [customBid, setCustomBid] = useState("");
            const [selectedTeam, setSelectedTeam] = useState(null);
            const [showLinks, setShowLinks] = useState(false);

             const [showPinModal, setShowPinModal] = useState(false);
            const [pinInput, setPinInput] = useState("");
            const [pinError, setPinError] = useState("");

            
            // Animation States
            const [animStage, setAnimStage] = useState('idle'); 
            const [scrambleText, setScrambleText] = useState("INITIALIZING");
            const [tempWinner, setTempWinner] = useState(null);
            const prevPlayerId = useRef(null); // Track player changes for Viewers

           const t = THEMES[theme];

            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                if (params.get('role') === 'viewer') {
                    setIsViewerMode(true);
                }
            }, []);
            // 1. Initial Load & Role Check
            useEffect(() => {
                const params = new URLSearchParams(window.location.search);
                if (params.get('role') === 'viewer') {
                    setIsAdmin(false);
                    setIsViewerMode(true);
                }
            }, []);

            // 2. Main Polling Loop
            useEffect(() => {
                const fetchData = async () => {
                    try {
                        const res = await fetch('/api/state/');
                        const json = await res.json();
                        
                        if (!json.error) {
                            setData(json);
                            
                            // === GRAND REVEAL LOGIC FOR VIEWERS ===
                            // If player ID changed, trigger reveal animation
                            if (json.current_player && json.current_player.id !== prevPlayerId.current) {
                                // Only animate if we had a previous state (don't boom on refresh)
                                if (prevPlayerId.current !== null) {
                                    setTempWinner(json.current_player);
                                    setAnimStage('revealed');
                                }
                                prevPlayerId.current = json.current_player.id;
                            } 
                            // If no player, reset tracking
                            else if (!json.current_player) {
                                prevPlayerId.current = null;
                                // Only reset stage if we aren't actively spinning as admin
                                if(animStage !== 'spinning') setAnimStage('idle');
                            }
                        }
                    } catch (e) { console.error(e); }
                };

                fetchData();
                const interval = setInterval(fetchData, 1000);
                return () => clearInterval(interval);
            }, [animStage]); // Dependency helps keep stage sync

            // 3. Admin Actions
            const doAction = async (action, payload = {}) => {
                if (action === 'SPIN') {
                    setAnimStage('spinning'); // Admin sees spin immediately
                    
                    // Trigger backend
                    await fetch('/api/action/', { method: 'POST', body: JSON.stringify({ action }) });
                    
                    // Short delay before fetching new winner (Reduced to 1.2s)
                    setTimeout(() => {
                        fetch('/api/state/')
                            .then(r => r.json())
                            .then(newData => {
                                setTempWinner(newData.current_player);
                                setAnimStage('revealed'); 
                                setData(newData);
                                // Update ref so we don't double-trigger
                                if(newData.current_player) prevPlayerId.current = newData.current_player.id;
                            });
                    }, 1200); // FASTER SPIN
                } else {
                    await fetch('/api/action/', { method: 'POST', body: JSON.stringify({ action, ...payload }) });
                }
            };

            const shareLink = (type) => {
                const url = `${window.location.origin}/dashboard/${type === 'viewer' ? '?role=viewer' : ''}`;
                const text = type === 'captain' ? `ðŸ§¢ Join Auction: ${url}` : `ðŸ‘€ Watch Live: ${url}`;
                window.open(`https://wa.me/?text=${encodeURIComponent(text)}`, '_blank');
            };

            const getImg = (p) => {
                if (!p) return "";
                if (p.image && p.image.length > 5) return p.image;
                return `https://api.dicebear.com/9.x/avataaars/svg?seed=${p.name}&top[]=shortHair&top[]=caesar&top[]=shortCurly&facialHairProbability=100&style=circle`;
            };

            // Scramble Text Effect
            useEffect(() => {
                if (animStage !== 'spinning') return;
                const words = ["SEARCHING", "MATCHING", "LOCKED", "TARGETING", "ANALYZING"];
                const interval = setInterval(() => setScrambleText(words[Math.floor(Math.random()*words.length)] + "..."), 100);
                return () => clearInterval(interval);
            }, [animStage]);
            const handleAdminClick = () => {
                if (isAdmin) {
                    setIsAdmin(false); // Logout is free
                } else {
                    setShowPinModal(true); // Login requires PIN
                    setPinInput("");
                    setPinError("");
                }
            };

            const submitPin = async () => {
                try {
                    const res = await fetch('/api/verify-pin/', {
                        method: 'POST',
                        body: JSON.stringify({ pin: pinInput })
                    });
                    const json = await res.json();
                    
                    if (json.success) {
                        setIsAdmin(true);
                        setShowPinModal(false);
                    } else {
                        setPinError("INCORRECT PIN");
                        setPinInput("");
                    }
                } catch (e) {
                    setPinError("Server Error");
                }
            };

            if (!data) return <div className={`min-h-screen flex flex-col items-center justify-center ${t.bg} text-cyan-400 font-hero tracking-widest text-3xl animate-pulse`}>LOADING STADIUM DATA...</div>;

            const { current_player, current_bid, teams, history, stats, auction_name } = data;

            return (
                <div className={`flex flex-col min-h-screen ${t.bg} ${t.text} transition-colors duration-700 relative`}>
                    
                    {/* === GRAND REVEAL OVERLAY (ADMIN & VIEWER) === */}
                    {(animStage === 'spinning' || animStage === 'revealed') && (
                        <div className="fixed inset-0 z-[100] flex items-center justify-center bg-black/95 backdrop-blur-3xl" onClick={isAdmin ? ()=>{setAnimStage('idle'); setTempWinner(null)} : null}>
                            
                            {/* SPINNING (Mostly Admin sees this, Viewers might see 'revealed' directly) */}
                            {animStage === 'spinning' && (
                                <div className="text-center relative">
                                    <div className="absolute inset-0 bg-cyan-500 blur-[100px] opacity-20"></div>
                                    <div className="w-64 h-64 rounded-full border-[1px] border-cyan-500/30 border-t-cyan-400 animate-spin mb-8 mx-auto flex items-center justify-center bg-black/50 shadow-[0_0_50px_rgba(6,182,212,0.2)]">
                                        <Trophy c="w-20 h-20 text-cyan-500/50"/>
                                    </div>
                                    <h2 className="font-tech text-6xl text-white tracking-widest animate-pulse drop-shadow-lg">{scrambleText}</h2>
                                    <p className="text-cyan-400 font-mono mt-4 text-sm tracking-[0.5em] opacity-80">ACCESSING DATABASE</p>
                                </div>
                            )}
                            
                            {/* REVEAL (Everyone sees this) */}
                            {animStage === 'revealed' && tempWinner && (
                                <div className="text-center animate-slam relative w-full max-w-4xl mx-auto px-4">
                                    {/* Rays Background */}
                                    <div className="absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 w-[800px] h-[800px] bg-gradient-to-t from-transparent via-cyan-500/10 to-transparent rays -z-10 opacity-50"></div>
                                    
                                    <div className="relative inline-block mb-10 group">
                                        <div className="absolute inset-0 bg-gradient-to-r from-cyan-500 to-blue-600 rounded-full blur-2xl opacity-50 group-hover:opacity-75 transition duration-1000"></div>
                                        <img src={getImg(tempWinner)} className="w-64 h-64 md:w-72 md:h-72 rounded-full border-4 border-white shadow-2xl relative z-10 bg-slate-900 object-cover" />
                                        <div className="absolute -bottom-5 left-1/2 -translate-x-1/2 bg-yellow-400 text-black px-8 py-2 font-black font-hero text-2xl md:text-3xl uppercase -skew-x-12 border-2 border-white shadow-[0_10px_20px_rgba(0,0,0,0.5)] z-20 whitespace-nowrap">
                                            {tempWinner.category}
                                        </div>
                                    </div>
                                    
                                    <h1 className="font-hero text-7xl md:text-9xl text-transparent bg-clip-text bg-gradient-to-b from-white to-slate-400 drop-shadow-[0_10px_10px_rgba(0,0,0,0.5)] leading-[0.8] mb-4">
                                        {tempWinner.name}
                                    </h1>
                                    
                                    <div className="flex flex-wrap justify-center gap-4 mb-12">
                                        <span className="font-tech text-xl md:text-2xl text-cyan-400 tracking-[0.3em] uppercase border border-cyan-500/30 px-4 py-1 rounded bg-cyan-950/30">{tempWinner.position}</span>
                                        {tempWinner.department && <span className="font-tech text-xl md:text-2xl text-purple-400 tracking-[0.3em] uppercase border border-purple-500/30 px-4 py-1 rounded bg-purple-950/30">{tempWinner.department}</span>}
                                    </div>
                                    
                                    {isAdmin ? (
                                        <button onClick={(e)=>{e.stopPropagation(); setAnimStage('idle'); setTempWinner(null)}} className="px-16 py-5 bg-white text-black font-black text-2xl tracking-widest rounded-full hover:scale-105 hover:shadow-[0_0_40px_rgba(255,255,255,0.4)] transition active:scale-95">
                                            OPEN BIDDING
                                        </button>
                                    ) : <p className="text-white/50 animate-pulse font-mono uppercase tracking-widest">Waiting for Auctioneer...</p>}
                                </div>
                            )}
                        </div>
                    )}
                          {/* === PIN MODAL === */}
                    {showPinModal && (
                        <div className="fixed inset-0 z-[200] flex items-center justify-center bg-black/90 backdrop-blur-md" onClick={() => setShowPinModal(false)}>
                            <div className="bg-slate-900 border border-slate-700 p-8 rounded-2xl shadow-2xl w-80 text-center animate-slam" onClick={e => e.stopPropagation()}>
                                <div className="mx-auto w-12 h-12 bg-slate-800 rounded-full flex items-center justify-center mb-4 text-cyan-400">
                                    <Lock size={24} />
                                </div>
                                <h3 className="font-hero text-2xl text-white mb-1">ADMIN ACCESS</h3>
                                <p className="text-xs text-slate-500 mb-6">Enter PIN to unlock controls</p>
                                
                                <input 
                                    type="password" 
                                    autoFocus
                                    maxLength="4"
                                    value={pinInput}
                                    onChange={e => setPinInput(e.target.value)}
                                    className="w-full bg-black/50 border border-slate-600 rounded-lg py-3 text-center text-2xl font-mono tracking-[0.5em] text-white focus:border-cyan-500 outline-none mb-4"
                                />
                                
                                {pinError && <p className="text-red-500 text-xs font-bold mb-4 animate-pulse">{pinError}</p>}
                                
                                <button onClick={submitPin} className="w-full py-3 bg-cyan-600 hover:bg-cyan-500 text-white font-bold rounded-lg transition">
                                    UNLOCK
                                </button>
                            </div>
                        </div>
                    )}
                    {/* === HEADER === */}
                    <header className={`h-auto md:h-16 ${t.panel} flex flex-col md:flex-row items-center justify-between px-6 py-2 z-30 shrink-0 sticky top-0`}>
                        <div className="flex items-center gap-4 w-full md:w-auto justify-between md:justify-start">
                            <div className="flex items-center gap-4">
                                <div className="w-10 h-10 rounded-lg bg-gradient-to-br from-cyan-500 to-blue-700 flex items-center justify-center shadow-lg shadow-cyan-500/20">
                                    <Trophy c="text-white w-6 h-6"/>
                                </div>
                                <div>
                                    <h1 className="font-hero text-3xl leading-none uppercase tracking-wide text-transparent bg-clip-text bg-gradient-to-r from-white to-slate-400">
                                        {auction_name}
                                    </h1>
                                    <div className={`flex items-center gap-2 text-[10px] font-bold tracking-[0.2em] ${t.subtext}`}>
                                        <span className="w-1.5 h-1.5 rounded-full bg-green-500 animate-pulse box-shadow-[0_0_10px_#22c55e]"></span> 
                                        {isViewerMode ? 'LIVE BROADCAST' : 'ADMIN CONSOLE'}
                                    </div>
                                </div>
                            </div>
                            
                            {/* Mobile Toggle */}
                            <div className="md:hidden flex gap-2">
                                <button onClick={()=>setTheme(theme==='dark'?'light':'dark')} className={`p-2 rounded-lg ${t.btnSec}`}>{theme==='dark' ? <Sun/> : <Moon/>}</button>
                            </div>
                        </div>
                        
                        {/* Ticker (Desktop) */}
                        <div className="hidden xl:flex flex-1 mx-12 h-9 rounded-md bg-black/20 border border-white/5 items-center overflow-hidden relative">
                            <div className="whitespace-nowrap animate-scroll absolute left-0 text-xs font-tech font-bold text-cyan-300/80 flex gap-12">
                                {history.length > 0 ? history.map((h, i) => (
                                    <span key={i} className="flex items-center gap-2">
                                        <span className="text-white">{h.player_name}</span> 
                                        <span className="text-slate-500">â†’</span> 
                                        <span className={`${t.accent}`}>{h.team_name}</span> 
                                        <span className="bg-green-500/20 text-green-400 px-1 rounded">${h.amount}</span>
                                    </span>
                                )) : <span>WAITING FOR FIRST SALE...</span>}
                            </div>
                        </div>

                        <div className="hidden md:flex gap-3 items-center">
                            {isAdmin && (
                                <div className="flex gap-2 mr-4 border-r border-white/10 pr-4">
                                    <button onClick={()=>setShowLinks(true)} className={`p-2 rounded-lg transition ${t.btnSec}`} title="Share"><Share2/></button>
                                    <a href="/export/" className={`p-2 rounded-lg transition ${t.btnSec}`} title="Export"><Download/></a>
                                </div>
                            )}
                            <button onClick={()=>setTheme(theme==='dark'?'light':'dark')} className={`p-2 rounded-lg ${t.btnSec}`}>{theme==='dark' ? <Sun/> : <Moon/>}</button>
                            
                           
                             {!isViewerMode && (
                                <button 
                                    onClick={handleAdminClick} 
                                    className={`px-4 py-1.5 text-xs font-bold border rounded-lg transition flex items-center gap-2 ${isAdmin ? 'bg-red-500/10 border-red-500 text-red-400 hover:bg-red-500/20' : t.btnSec}`}
                                >
                                    {isAdmin ? 'EXIT ADMIN' : 'ADMIN LOGIN'}
                                </button>
                            )}
                        </div>
                    </header>

                    {/* === MAIN CONTENT === */}
                    <main className="flex-1 flex flex-col lg:flex-row overflow-auto lg:overflow-hidden p-4 gap-4">
                        
                        {/* --- LEFT COLUMN: STAGE --- */}
                        <section className="flex-1 lg:flex-[0.35] flex flex-col gap-4 min-h-min lg:overflow-hidden">
                            
                            {/* PLAYER CARD */}
                            <div className={`relative flex-shrink-0 ${t.panel} rounded-2xl p-1 flex flex-col overflow-hidden`}>
                                {/* Background Accent */}
                                <div className="absolute top-0 left-0 w-full h-1 bg-gradient-to-r from-cyan-500 to-purple-600"></div>
                                <div className="absolute top-0 right-0 w-64 h-64 bg-cyan-500/5 blur-[80px] rounded-full pointer-events-none"></div>

                                <div className="flex-1 flex flex-col items-center justify-center relative p-6">
                                    {!current_player ? (
                                        <div className="text-center py-10">
                                            <div className={`w-32 h-32 rounded-full border border-dashed flex items-center justify-center mx-auto mb-6 ${t.border} bg-white/5`}>
                                                <Trophy c={`w-10 h-10 ${t.subtext}`}/>
                                            </div>
                                            {isAdmin ? (
                                                <button onClick={()=>doAction('SPIN')} className={`px-12 py-4 rounded-full font-hero text-2xl tracking-widest transition transform hover:scale-105 active:scale-95 ${t.btnMain}`}>
                                                    SPIN WHEEL
                                                </button>
                                            ) : (
                                                <div>
                                                    <p className={`font-tech text-2xl animate-pulse ${t.accent}`}>STAND BY</p>
                                                    <p className={`text-xs ${t.subtext} mt-2`}>NEXT PLAYER UP SOON</p>
                                                </div>
                                            )}
                                        </div>
                                    ) : (
                                        <div className="w-full flex flex-col items-center animate-in fade-in zoom-in duration-500">
                                            {/* Avatar with Spotlight */}
                                            <div className="relative mb-4">
                                                <div className="absolute inset-0 bg-cyan-500/20 blur-2xl rounded-full spotlight"></div>
                                                <img src={getImg(current_player)} className={`w-32 h-32 md:w-40 md:h-40 rounded-full border-4 shadow-2xl relative z-10 object-cover ${theme==='dark'?'border-slate-800 bg-slate-900':'border-white bg-slate-100'}`} />
                                            </div>

                                            <h2 className="font-hero text-5xl mb-1 leading-none text-center drop-shadow-md">{current_player.name}</h2>
                                            
                                            <div className="flex gap-2 mb-6">
                                                <span className="text-[10px] font-bold uppercase px-3 py-1 rounded bg-white/10 border border-white/10">{current_player.category}</span>
                                                <span className={`text-[10px] font-bold uppercase px-3 py-1 rounded border ${theme==='dark'?'bg-cyan-500/10 border-cyan-500/30 text-cyan-400':'bg-blue-100 border-blue-200 text-blue-600'}`}>{current_player.position}</span>
                                            </div>

                                            {/* BIDDING CONTROLS */}
                                            <div className={`w-full ${theme==='dark'?'bg-black/40':'bg-slate-50'} rounded-xl p-4 border ${t.border}`}>
                                                <div className="flex justify-between items-end mb-4 border-b border-dashed border-white/10 pb-3">
                                                    <div>
                                                        <span className={`text-[10px] font-bold uppercase block tracking-wider ${t.subtext}`}>Current Bid</span>
                                                        <span className={`text-[10px] opacity-60 font-mono`}>BASE: {current_player.base_price}</span>
                                                    </div>
                                                    <div className="font-hero text-5xl text-green-500 leading-none drop-shadow-[0_0_15px_rgba(34,197,94,0.4)]">
                                                        {current_bid}
                                                    </div>
                                                </div>

                                                {isAdmin ? (
                                                    <div className="space-y-3">
                                                        <div className="grid grid-cols-4 gap-2">
                                                            {[50, 100, 200, 500].map(amt => (
                                                                <button key={amt} onClick={()=>doAction('BID', {amount: current_bid + amt})} className={`py-2 rounded font-bold text-[10px] transition transform active:scale-95 ${t.btnSec}`}>+{amt}</button>
                                                            ))}
                                                        </div>
                                                        <div className="flex gap-2">
                                                            <input type="number" placeholder="Custom" value={customBid} onChange={e=>setCustomBid(e.target.value)} className={`flex-1 px-3 py-2 rounded text-sm font-bold outline-none ${t.input}`}/>
                                                            <button onClick={()=>{if(customBid) doAction('BID', {amount: parseInt(customBid)}); setCustomBid('');}} className={`px-4 rounded font-bold text-xs ${t.btnSec}`}>SET</button>
                                                        </div>
                                                        <button onClick={()=>doAction('UNSOLD')} className="w-full py-3 border border-red-500/30 text-red-400 bg-red-500/5 hover:bg-red-500/10 rounded-lg font-bold text-xs tracking-widest uppercase transition">
                                                            Pass / Unsold
                                                        </button>
                                                    </div>
                                                ) : (
                                                    <div className="text-center py-4 bg-white/5 rounded-lg border border-white/5">
                                                        <p className={`text-xs font-bold uppercase tracking-widest ${t.subtext} mb-2`}>Bidding In Progress</p>
                                                        <div className="flex justify-center gap-1">
                                                            <div className="w-2 h-2 bg-green-500 rounded-full animate-bounce"></div>
                                                            <div className="w-2 h-2 bg-green-500 rounded-full animate-bounce delay-100"></div>
                                                            <div className="w-2 h-2 bg-green-500 rounded-full animate-bounce delay-200"></div>
                                                        </div>
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    )}
                                </div>
                            </div>

                            {/* FEED */}
                            <div className={`h-40 ${t.panel} rounded-2xl p-4 flex flex-col flex-shrink-0`}>
                                <h3 className={`text-[10px] font-bold uppercase mb-3 flex items-center gap-2 ${t.subtext}`}>
                                    <div className="w-1.5 h-1.5 bg-cyan-500 rounded-full"></div> Recent Sales
                                </h3>
                                <div className="flex-1 overflow-y-auto space-y-2 pr-1 custom-scrollbar">
                                    {history.map((h, i) => (
                                        <div key={i} className={`flex justify-between items-center text-[11px] p-2 rounded border-l-2 border-green-500 bg-white/5`}>
                                            <div>
                                                <span className="font-bold block text-white leading-tight">{h.player_name}</span>
                                                <span className={`text-[9px] opacity-60 uppercase`}>{h.team_name}</span>
                                            </div>
                                            <span className="font-mono font-bold text-green-400">${h.amount}</span>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        </section>

                        {/* --- RIGHT COLUMN: TEAMS --- */}
                        <section className={`flex-1 lg:flex-[0.65] ${t.panel} rounded-2xl p-5 overflow-y-auto relative`}>
                            <h3 className={`font-hero text-2xl mb-6 flex items-center gap-2 tracking-wide ${t.text}`}>
                                <Users className={t.accent}/> TEAM STANDINGS
                            </h3>
                            
                            <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-2 xl:grid-cols-3 gap-4 pb-20">
                                {teams.map((team) => {
                                    const canAfford = team.budget >= current_bid;
                                    const isFull = team.players_count >= 15;
                                    const gradient = TEAM_GRADIENTS[team.id % TEAM_GRADIENTS.length];
                                    
                                    return (
                                        <div key={team.id} onClick={()=>setSelectedTeam(team)} className={`relative p-5 rounded-xl cursor-pointer group transition-all duration-300 hover:-translate-y-1 hover:shadow-xl border ${theme==='dark'?'bg-white/5 border-white/5 hover:border-cyan-500/30':'bg-white border-slate-200 hover:border-blue-400'}`}>
                                            
                                            {/* Sell Overlay */}
                                            {isAdmin && current_player && (
                                                <div className={`absolute inset-0 z-20 opacity-0 group-hover:opacity-100 transition flex flex-col items-center justify-center rounded-xl gap-2 backdrop-blur-md bg-black/60`} onClick={e=>e.stopPropagation()}>
                                                    {canAfford && !isFull ? (
                                                        <button onClick={()=>doAction('SELL', {team_id: team.id})} className="bg-green-500 hover:bg-green-400 text-black font-bold px-6 py-2 rounded-full shadow-[0_0_20px_rgba(34,197,94,0.6)] text-xs flex items-center gap-2 transform hover:scale-105 transition">
                                                            <Gavel className="w-4 h-4"/> SELL
                                                        </button>
                                                    ) : <span className="text-red-400 font-bold flex gap-1 items-center text-xs uppercase border border-red-500/50 px-3 py-1 rounded bg-red-950/50"><XCircle className="w-3 h-3"/> {isFull?'Full':'No Funds'}</span>}
                                                </div>
                                            )}

                                            <div className="flex justify-between items-start mb-3">
                                                <div>
                                                    <h4 className="font-hero text-2xl leading-none truncate w-32 uppercase tracking-wide">{team.name}</h4>
                                                    <p className={`text-[10px] mt-1 flex items-center gap-1 opacity-60 group-hover:opacity-100 transition ${t.accent}`}>View Squad <ChevronRight className="w-3 h-3"/></p>
                                                </div>
                                                <div className="text-right">
                                                    <div className={`font-tech text-3xl font-bold leading-none ${t.accent}`}>{team.budget}</div>
                                                    <div className="text-[9px] font-bold uppercase tracking-widest opacity-50">Pts Left</div>
                                                </div>
                                            </div>

                                            <div className="w-full h-1.5 bg-black/20 rounded-full overflow-hidden mb-2">
                                                <div className={`h-full bg-gradient-to-r ${gradient} transition-all duration-700`} style={{width: `${(team.players_count/15)*100}%`}}></div>
                                            </div>
                                            <div className={`flex justify-between text-[9px] font-bold uppercase opacity-60`}>
                                                <span>{team.players_count}/15 Players</span>
                                                <span>Spent: {team.spent}</span>
                                            </div>
                                        </div>
                                    )
                                })}
                            </div>
                        </section>
                    </main>

                    {/* MODAL: SHARE LINKS */}
                    {showLinks && (
                        <div className="fixed inset-0 z-[150] flex items-center justify-center bg-black/80 backdrop-blur-sm" onClick={()=>setShowLinks(false)}>
                            <div className={`${t.panel} p-8 rounded-3xl max-w-sm w-full space-y-6 shadow-2xl animate-slam bg-[#0f172a]`} onClick={e=>e.stopPropagation()}>
                                <div className="text-center">
                                    <div className="w-16 h-16 rounded-full bg-cyan-500/10 flex items-center justify-center mx-auto mb-4 border border-cyan-500/20">
                                        <Share2 className="text-cyan-400 w-8 h-8"/>
                                    </div>
                                    <h3 className="text-2xl font-hero text-white mb-1">Invite Participants</h3>
                                    <p className="text-xs text-slate-400">Share these links via WhatsApp</p>
                                </div>
                                <div className="space-y-3">
                                    <button onClick={()=>shareLink('captain')} className="w-full py-4 bg-gradient-to-r from-green-600 to-emerald-600 hover:from-green-500 hover:to-emerald-500 text-white rounded-xl font-bold transition shadow-lg flex items-center justify-center gap-2">
                                        <span>ðŸ§¢ Captain Link</span>
                                    </button>
                                    <button onClick={()=>shareLink('viewer')} className="w-full py-4 bg-slate-700 hover:bg-slate-600 text-white rounded-xl font-bold transition flex items-center justify-center gap-2 border border-slate-600">
                                        <span>ðŸ‘€ Viewer Link</span>
                                    </button>
                                </div>
                            </div>
                        </div>
                    )}

                    {/* MODAL: TEAM ROSTER */}
                    {selectedTeam && (
                        <div className="fixed inset-0 z-50 flex items-center justify-end bg-black/60 backdrop-blur-sm" onClick={()=>setSelectedTeam(null)}>
                            <div className={`w-full md:w-[450px] h-full shadow-2xl flex flex-col animate-slide-in ${theme==='dark'?'bg-slate-900 border-l border-slate-700':'bg-white border-l border-slate-200'}`} onClick={e=>e.stopPropagation()}>
                                <div className={`h-20 border-b flex items-center justify-between px-8 ${theme==='dark'?'border-slate-800 bg-slate-900':'border-slate-200 bg-white'}`}>
                                    <div>
                                        <h2 className="font-hero text-3xl uppercase tracking-wide">{selectedTeam.name}</h2>
                                        <p className={`text-xs ${t.subtext}`}>Full Squad List</p>
                                    </div>
                                    <button onClick={()=>setSelectedTeam(null)} className="p-2 hover:bg-white/5 rounded-full transition"><Close className="w-6 h-6 opacity-50 hover:opacity-100"/></button>
                                </div>
                                
                                <div className="grid grid-cols-2 border-b border-white/5">
                                    <div className="p-4 text-center border-r border-white/5">
                                        <div className="text-2xl font-tech font-bold text-cyan-400">{selectedTeam.budget}</div>
                                        <div className="text-[10px] uppercase font-bold opacity-50">Remaining</div>
                                    </div>
                                    <div className="p-4 text-center">
                                        <div className="text-2xl font-tech font-bold text-white">{selectedTeam.players_count}</div>
                                        <div className="text-[10px] uppercase font-bold opacity-50">Players</div>
                                    </div>
                                </div>

                                <div className="flex-1 overflow-y-auto p-6 space-y-3 custom-scrollbar">
                                    {history.filter(h => h.team_name === selectedTeam.name).map((p, i) => (
                                        <div key={i} className={`flex items-center gap-4 p-3 rounded-xl border transition hover:translate-x-1 ${theme==='dark'?'bg-white/5 border-white/5 hover:border-cyan-500/30':'bg-slate-50 border-slate-200 hover:border-blue-400'}`}>
                                            <div className={`w-8 h-8 rounded-lg flex items-center justify-center font-hero text-lg bg-gradient-to-br ${TEAM_GRADIENTS[selectedTeam.id % TEAM_GRADIENTS.length]} text-white shadow-lg`}>{i+1}</div>
                                            <div className="flex-1">
                                                <h4 className="font-bold leading-tight text-sm uppercase tracking-wide">{p.player_name}</h4>
                                                <p className="text-[10px] opacity-50 mt-0.5">Purchased via Auction</p>
                                            </div>
                                            <div className="font-mono font-bold text-green-500">${p.amount}</div>
                                        </div>
                                    ))}
                                    {history.filter(h => h.team_name === selectedTeam.name).length === 0 && (
                                        <div className="text-center opacity-30 mt-20">
                                            <Users className="w-12 h-12 mx-auto mb-2"/>
                                            <p className="text-sm font-bold uppercase">No Players Yet</p>
                                        </div>
                                    )}
                                </div>
                            </div>
                        </div>
                    )}

                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
    {% endverbatim %}
</body>
</html>